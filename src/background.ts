'use strict'

import {app, protocol, globalShortcut, BrowserWindow, ipcMain, WebContents} from 'electron'
import {createProtocol} from 'vue-cli-plugin-electron-builder/lib'
import {autoUpdater} from 'electron-updater'

const isDevelopment = process.env.NODE_ENV !== 'production'
let win: BrowserWindow | null
let webContents: WebContents
protocol.registerSchemesAsPrivileged([{scheme: 'app', privileges: {secure: true, standard: true}}])

const feedUrl = 'http://127.0.0.1/' // 更新包位置

function createWindow() {
  // 创建浏览器窗口
  win = new BrowserWindow({
    width: 800, height: 600, webPreferences: {
      nodeIntegration: true,
      webviewTag: true
    },
  })

  if (process.env.WEBPACK_DEV_SERVER_URL) {
    // 如果处于开发模式，则加载dev服务器的url
    win.loadURL(process.env.WEBPACK_DEV_SERVER_URL as string)
    if (!process.env.IS_TEST) {
      BrowserWindow.addDevToolsExtension('./DevTool')
    }
  } else {
    createProtocol('app')
    // 在未开发时加载index.html
    win.loadURL('app://./index.html')
  }

  webContents = win.webContents

  win.on('closed', () => {
    win = null
  })
}

// 主进程监听渲染进程传来的信息
ipcMain.on('update', (e, arg) => {
  console.log('update')
  checkForUpdates()
})

//在主线程下，通过ipcMain对象监听渲染线程传过来的getPrinterList事件
ipcMain.on('getPrinterList', (event) => {
  //主线程获取打印机列表
  const list = webContents.getPrinters()
  console.log(list)
  //通过webContents发送事件到渲染线程，同时将打印机列表也传过去
  win.webContents.send('getPrinterList', list)
  win.webContents.send('webview-print-render', 'data:image/png;base64,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')
})

let checkForUpdates = () => {
  // 配置安装包远端服务器
  autoUpdater.setFeedURL(feedUrl)

  // 下面是自动更新的整个生命周期所发生的事件
  autoUpdater.on('error', (message) => {
    sendUpdateMessage('error', message)
  })
  autoUpdater.on('checking-for-update', (message) => {
    sendUpdateMessage('checking-for-update', message)
  })
  autoUpdater.on('update-available', (message) => {
    sendUpdateMessage('update-available', message)
  })
  autoUpdater.on('update-not-available', (message) => {
    sendUpdateMessage('update-not-available', message)
  })

  // 更新下载进度事件
  autoUpdater.on('download-progress', (progressObj) => {
    sendUpdateMessage('downloadProgress', progressObj)
  })
  // 更新下载完成事件
  autoUpdater.on('update-downloaded', (event, releaseNotes, releaseName, releaseDate, updateUrl, quitAndUpdate) => {
    sendUpdateMessage('isUpdateNow')
    ipcMain.on('updateNow', (e, arg) => {
      autoUpdater.quitAndInstall()
    })
  })

  //执行自动更新检查
  autoUpdater.checkForUpdates()
}

// 主进程主动发送消息给渲染进程函数
function sendUpdateMessage(message: string, data: any = '') {
  console.log({message, data})
  webContents.send('message', {message, data})
}


// 关闭所有窗口后退出
app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit()
  }
})

app.on('activate', () => {
  if (win === null) {
    createWindow()
  }
})

app.on('ready', async () => {
  createWindow()
  //CTRL+E打开调制工具
  globalShortcut.register('CommandOrControl+E', () => {
    win.webContents.openDevTools()
  })
})

if (isDevelopment) {
  if (process.platform === 'win32') {
    process.on('message', data => {
      if (data === 'graceful-exit') {
        app.quit()
      }
    })
  } else {
    process.on('SIGTERM', () => {
      app.quit()
    })
  }
}
